<app-loader [enabled]="(isLoading|async)===true" [marginTop]="100" loadingText=""
  [loadingProgress]="(workflowsLoadingStatus$ | async)?.completionPercentage"
  loadingTextAlt="...loading<br/><span class='ml-5'>workflows ...</span>"></app-loader>

<p-progressBar *ngIf="(workflowsLoadingStatus$ | async)?.completionPercentage !== 100" mode="determinate"
  [value]="(workflowsLoadingStatus$ | async)?.completionPercentage"></p-progressBar>

<app-workflow-uploader></app-workflow-uploader>

<div style="background: #f4f6f9;" data-swipe-threshold="300" data-swipe-timeout="2000">
  <div class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1 class="m-0 text-dark"></h1>
        </div>
        <!-- /.col -->
        <div class="col-sm-6">
          <ol class="breadcrumb float-right mr-lg-4 mr-md-2">
            <li class="breadcrumb-item active">
              <i class="fas fa-home p-1"></i>Home
            </li>
          </ol>
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
  </div>
  <!-- /.content-header -->

  <!-- Main content -->
  <div class="content mx-lg-4 mx-md-2 my-md-3">
    <!-- *ngIf="workflows && (isLoading|async)===false -->
    <ng-container>
      <h2 class="text-primary font-weight-light p-2">
        <div>
          <span *ngIf="((isLoading|async)===true)" data-toggle="tooltip" data-placement="right" data-html="true"
            title="The dashboard collects your subscribed workflows">
            {{ "Loading " + (isUserLogged() ? "Dashboard" : "Workflows") + "....."}}
          </span>
          <span *ngIf="(isLoading|async)===false && (!workflowNameFilter || workflowNameFilter.length==0)"
            pTooltip="{{ isUserLogged() ? 'the dashboard collects your workflow subscriptions' : 'registered workflows' }}"
            showDelay=2000 data-placement="right" data-html="true">
            {{ isUserLogged() ? "Dashboard" : "Workflows" }}
          </span>
        </div>
        <div *ngIf="workflowNameFilter && workflowNameFilter.length>0">
          <ng-container *ngIf="(isLoading|async)===true; then searchingForWorkflows; else searchResults;">
          </ng-container>
          <ng-template #searchingForWorkflows>
            {{workflowNameFilter !== '______ALL_____' ? "Searching....." : "Loading....."}}
          </ng-template>
          <ng-template #searchResults>
            <ng-container
              *ngIf="((workflows | itemFilterPipe: workflowNameFilter).length == 0); then noWorkflow; else foundWorkflows">
            </ng-container>
          </ng-template>
          <ng-template #noWorkflow>
            <ng-container
              *ngIf="workflowNameFilter == '______ALL_____'; then noWorkflowFound; else noMatchingWorkflow;">
            </ng-container>
            <ng-template #noWorkflowFound>No workflow found</ng-template>
            <ng-template #noMatchingWorkflow>No workflow matching "<b>{{workflowNameFilter}}</b>"</ng-template>
          </ng-template>
          <ng-template #foundWorkflows>
            <ng-container *ngIf="workflowNameFilter == '______ALL_____'; then allWorkflows; else matchingWorkflows;">
            </ng-container>
            <ng-template #allWorkflows>
              {{ browseButtonEnabled && isUserLogged() ? 'Registered Workflows' : isUserLogged() ? "Dashboard" :
              "Workflows" }}
            </ng-template>
            <ng-template #matchingWorkflows>Workflows matching "<b>{{workflowNameFilter}}</b>"</ng-template>
          </ng-template>
        </div>
      </h2>

      <div class="container-fluid">
        <!-- Small boxes (Stat box) -->
        <div class="row">
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-test-passed" (click)="filterByStatus('all_passing')" data-toggle="tooltip"
              tooltipPosition="bottom" data-html="true" [showDelay]="tooltipShowDelay"
              pTooltip="<div class='text-xs text-center'><i class='fas fa-question-circle mx-1'></i> click to filter <b>passing</b> workflows</div>">
              <!-- Loading (remove the following to stop the loading)-->
              <div *ngIf="(isLoading|async)===true" class="overlay dark">
                <i class="fas fa-3x fa-sync-alt"></i>
              </div>
              <div *ngIf="!(isLoading|async) && workflows && statusFilter && statusFilter != 'all_passing'"
                class="overlay dark"></div>
              <!-- end loading -->
              <div class="inner">
                <h3>{{ workflows ? getStatsLength(workflowStats.all_passing) : 0 }}</h3>
                <p>Passing</p>
              </div>
              <div class="icon">
                <i class="fa fa-thumbs-up"></i>
              </div>
              <div class="small-box-footer" style="height: 22px">
                <div style="display: inline-block; padding: 0"></div>
                <!-- More info <i class="fas fa-arrow-circle-right"></i> -->
              </div>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-test-error" (click)="filterByStatus('some_passing')" data-toggle="tooltip"
              tooltipPosition="bottom" data-html="true" [showDelay]="tooltipShowDelay"
              pTooltip="<div class='text-xs text-center'><i class='fas fa-question-circle mx-1'></i> click to filter workflows partially <b>passing</b></div>">
              <!-- Loading (remove the following to stop the loading)-->
              <div *ngIf="(isLoading|async)===true" class="overlay dark">
                <i class="fas fa-3x fa-sync-alt"></i>
              </div>
              <div *ngIf="!(isLoading|async) && workflows && statusFilter && statusFilter != 'some_passing'"
                class="overlay dark"></div>
              <div class="inner">
                <h3>{{ workflows ? getStatsLength(workflowStats.some_passing) : 0 }}</h3>
                <p>Some passing</p>
              </div>
              <div class="icon">
                <i class="fas fa-radiation"></i>
              </div>
              <div class="small-box-footer" style="height: 22px">
                <div style="display: inline-block; padding: 0"></div>
                <!-- More info <i class="fas fa-arrow-circle-right"></i> -->
              </div>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-test-failed" (click)="filterByStatus('all_failing')" data-toggle="tooltip"
              tooltipPosition="bottom" data-html="true" [showDelay]="tooltipShowDelay"
              pTooltip="<div class='text-xs text-center'><i class='fas fa-question-circle mx-1'></i> click to filter <b>failing</b> workflows</div>">
              <!-- Loading (remove the following to stop the loading)-->
              <div *ngIf="(isLoading|async)===true" class="overlay dark">
                <i class="fas fa-3x fa-sync-alt"></i>
              </div>
              <div *ngIf="!(isLoading|async) && workflows && statusFilter && statusFilter != 'all_failing'"
                class="overlay dark"></div>
              <div class="inner">
                <h3>{{ workflows ? getStatsLength(workflowStats.all_failing) : 0 }}</h3>
                <p>Failing</p>
              </div>
              <div class="icon">
                <i class="fa fa-thumbs-down"></i>
              </div>
              <div class="small-box-footer" style="height: 22px">
                <div style="display: inline-block; padding: 0"></div>
                <!-- More info <i class="fas fa-arrow-circle-right"></i> -->
              </div>
            </div>
          </div>
          <!-- ./col -->

          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-test-aborted" (click)="filterByStatus('unknown')" data-html="true"
              data-toggle="tooltip" tooltipPosition="bottom" [showDelay]="tooltipShowDelay"
              pTooltip="<div class='text-xs text-center'><i class='fas fa-question-circle mx-1'></i> click to filter workflows in <b>unknown</b> state</div>">
              <!-- Loading (remove the following to stop the loading)-->
              <div *ngIf="(isLoading|async)===true" class="overlay dark">
                <i class="fas fa-3x fa-sync-alt"></i>
              </div>
              <div *ngIf="!(isLoading|async) && workflows && statusFilter && statusFilter != 'unknown'"
                class="overlay dark"></div>
              <div class="inner">
                <h3>{{ workflows ? getStatsLength(workflowStats.unknown) : 0 }}</h3>

                <p>Unavailable</p>
              </div>
              <div class="icon">
                <i class="fa fa-question-circle"></i>
              </div>
              <div class="small-box-footer" style="height: 22px">
                <div style="display: inline-block; padding: 0"></div>
                <!-- More info <i class="fas fa-arrow-circle-right"></i> -->
              </div>
            </div>
          </div>
          <!-- ./col -->
        </div>
        <!-- /.row -->
      </div>

    </ng-container>
    <!-- Main row -->

    <div class="container-fluid">
      <!-- Search Bar -->
      <item-search-bar elementType="workflows" [(filterValue)]="workflowNameFilter"
        *ngIf="workflows && (isLoading|async)!==true" [(sortingOrder)]="workflowSortingOrder" [allowEmptySearch]="false"
        [searchButtonName]="'Search'" (browseEnabled)="setBrowseButtonEnabled($event)"
        [enableBrowseButton]="isUserLogged()" [goBackButtonName]="'Dashboard'"></item-search-bar>

      <!-- <div class="py-4"> -->
      <div class="card card-primary card-outline p-0 m-0" [hidden]="!workflows || (isLoading|async)===true">
        <div *ngIf="updatingDataTable" class="overlay">
          <i class="fas fa-3x fa-sync-alt text-primary"></i>
        </div>

        <!-- Loading (remove the following to stop the loading)-->
        <div class="card-body box-profile p-0">
          <p-dataView #workflowsDataView
            [value]="workflows | itemFilterPipe: workflowNameFilter | workflowOrderBy:'modified':'desc'"
            [paginator]="true" filterBy="Workflow" [rows]="6" layout="list" [sortField]="sortField"
            [sortOrder]="sortOrder">
            <ng-template pTemplate="header">
              <div class="d-flex py-4 align-items-center justify-content-center">
                <div class="flex-lg-fill align-items-center justify-content-center justify-content-lg-start">
                  <div *ngIf="currentLayout === 'grid'" class="d-inline-block mx-3 mx-lg-0 flex-grow">
                    <a class="btn btn-sm" (click)="refreshDashboard()">
                      <i class="fas fa-sync fa-lg text-primary"></i>
                    </a>
                  </div>
                </div>
                <div
                  class="d-inline-flex flex-lg-fill align-items-center justify-content-center justify-content-lg-end">
                  <div *ngIf="isUserLogged() && false" class="d-none d-xl-block mx-3">
                    <a *ngIf="!editModeEnabled" class="btn btn-sm" (click)="openWorkflowUploader()">
                      <i class="fas fa-plus-circle mx-1"></i><span class="d-none d-xl-inline-block">add</span>
                    </a>
                    <a *ngIf="!editModeEnabled" class="btn btn-sm" (click)="editModeToggle()">
                      <span *ngIf="workflows && workflows.length > 0">
                        <i class="far fa-edit mx-1"></i><span class="d-none d-xl-inline-block">edit</span>
                      </span>
                    </a>
                    <a *ngIf="editModeEnabled" class="btn btn-sm active" (click)="editModeToggle()">
                      <i class="far fa-window-close"></i> done
                    </a>
                  </div>
                  <div *ngIf="isUserLogged() && currentLayout=== 'grid'" class="d-none d-xl-block mx-3 mx-xs-4 mx-lg-0">
                    <a *ngIf="!editModeEnabled" class="btn btn-sm" (click)="openWorkflowUploader()">
                      <i class="fas fa-plus-circle fa-lg text-primary mx-1"></i>
                    </a>
                  </div>
                  <div class="d-inline-flex mx-md-3">
                    <p-dropdown [options]="sortOptions" [(ngModel)]="sortCriterion" placeholder="Sort By"
                      (onChange)="onSortChangeEvent($event)" autoWidth="false" [style]="{'width': '140px'}">
                      <ng-template let-c pTemplate="selectedItem">
                        <span class="mx-2">
                          <i class="{{c.iconClass}}" [pTooltip]="c.description"
                            style="position: absolute; top: 10px;"></i>
                        </span>
                        <span style="margin-left: 17px"></span>
                        {{ c.label }}
                      </ng-template>
                      <ng-template let-c pTemplate="item">
                        <div [pTooltip]="c.description" tooltipPosition="right">
                          <span class="mx-1">
                            <i class="{{c.iconClass}}" style="font: 0.7rem;"></i>
                          </span>
                          {{ c.label }}
                        </div>
                      </ng-template>
                    </p-dropdown>
                  </div>
                  <p-dataViewLayoutOptions class="d-line-block mx-1">
                  </p-dataViewLayoutOptions>

                  <div *ngIf="isUserLogged() && currentLayout === 'grid'"
                    class="d-inline-block d-xl-none mx-md-3 mx-lg-0">
                    <a *ngIf="!editModeEnabled" class="btn btn-sm" (click)="openWorkflowUploader()"
                      pTooltip="click to register a workflow" [showDelay]="tooltipShowDelay" tooltipPosition="top"
                      data-toggle="tooltip" tooltipPosition="top" data-html="true">
                      <i class="fas fa-plus-circle fa-lg text-primary"></i>
                    </a>
                  </div>
                </div>
              </div>

              <div class="d-flex mt-3 d-none d-sm-block" *ngIf="layout === 'list'">
                <div class="d-inline-flex row workflow-list-item-header">
                  <div class="col-2 col-md-1 workflow-list-item-status m-0 p-0 text-center">
                    <a class="btn btn-sm" (click)="refreshDashboard()" pTooltip="refresh workflow list"
                      [showDelay]="tooltipShowDelay" tooltipPosition="top">
                      <i class="fas fa-sync fa-lg text-primary"></i>
                    </a>
                  </div>
                  <div class="col-10 col-md-6 col-xl-5"
                    [ngClass]="{'col-5': true, 'text-primary': sortField === 'name'}">Workflow
                    <span *ngIf="!sortField || sortField !== 'name'" (click)="onSortChange({field: 'name', order: 1})">
                      <i class="fas fa-sort-amount-up-alt text-muted"></i>
                    </span>
                    <span *ngIf="sortField === 'name' && sortOrder === 1"
                      (click)="onSortChange({field: 'name', order: -1})">
                      <i class="fas fa-sort-amount-up-alt"></i>
                    </span>
                    <span *ngIf="sortField === 'name' && sortOrder === -1"
                      (click)="onSortChange({field: 'modified', order: -1})">
                      <i class="fas fa-sort-amount-down-alt"></i>
                    </span>
                  </div>
                  <div class="col-1 d-none d-xl-block text-center">Visibility</div>
                  <div class="col-1 d-none d-xl-block text-center" [ngClass]="{'text-primary': sortField === 'type'}">
                    Type
                    <span *ngIf="!sortField || sortField !== 'type'" (click)="onSortChange({field: 'type', order: 1})">
                      <i class="fas fa-sort-amount-up-alt text-muted"></i>
                    </span>
                    <span *ngIf="sortField === 'type' && sortOrder === 1"
                      (click)="onSortChange({field: 'type', order: -1})">
                      <i class="fas fa-sort-amount-up-alt"></i>
                    </span>
                    <span *ngIf="sortField === 'type' && sortOrder === -1"
                      (click)="onSortChange({field: 'modified', order: -1})">
                      <i class="fas fa-sort-amount-down-alt"></i>
                    </span>
                  </div>
                  <div class="col-2 col-xl-1 d-none d-md-block text-center">Version</div>
                  <div class="col-1 d-none d-xl-block text-center">Suites</div>
                  <div class="col-3 col-xl-2 d-none d-md-block text-center">Latest Test Builds</div>
                </div>
                <div class="d-inline-flex flex-column workflow-list-item-actions-header justify-content-center my-md-3">
                  <div *ngIf="isUserLogged()" class="d-inline-block workflow-list-item-add-action">
                    <a *ngIf="!editModeEnabled && isUserLogged()" class="text-center" (click)="openWorkflowUploader()"
                      pTooltip="click to register a workflow" [showDelay]="tooltipShowDelay" tooltipPosition="top">
                      <i class="fas fa-plus-circle fa-lg" style="margin-left: 5px;"></i>
                      <!-- <div class="d-block text-sm">Add</div> -->
                    </a>
                  </div>
                </div>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="listItem">
              <div class="d-flex">
                <div class="d-inline-flex row workflow-list-item">
                  <div class="col-2 col-md-1 text-center workflow-list-item-status m-0 p-0" [pTooltip]="item.statusText"
                    tooltipPosition="top" [showDelay]="tooltipShowDelay">
                    <div class="workflow-list-item-status" [ngClass]="item.class">
                      <i class="{{ item.statusIcon }} fa-2x"></i>
                    </div>
                  </div>

                  <div class="col-10 col-md-6 col-xl-5">

                    <div class="workflow-list-item-description">
                      <!-- Workflow Name -->
                      <div class="item-name" [class.large-font]="item.workflow.name">
                        <input *ngIf="item.editingMode" type="text" class="form-control datatable-input-no-border"
                          [(ngModel)]="item.workflow.name" aria-describedby="workflowNameInput"
                          placeholder="Enter workflow name" (keyup.enter)="updateWorkflowName(item)"
                          (keyup.esc)="restoreWorkflowName(item)" autofocus>
                        <a *ngIf="!item.editingMode" (click)="showWorkflowDetails(item)"
                          style="color: black; font-size: larger" (dblclick)="enableWorkflowEditMode(item)"
                          data-toggle="tooltip" data-placement="top" data-html="true" [showDelay]="tooltipShowDelay"
                          pTooltip="<div class='text-xs text-center'><i class='fas fa-question-circle mx-1'></i> click to see <b>suites</b><i class='fas fa-external-link-alt mx-1'></i>
                    {{ isEditable(item) ? 'or double click to edit' : ''}}</div>">
                          {{ item.workflow.name }}
                        </a>
                      </div>

                      <!-- Workflow Details -->
                      <div class="workflow-item-details">

                        <!-- Workflow UUID -->
                        <div class="item-detail">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-solid fa-fingerprint" style="margin-right: .2rem"></i>
                          </span>
                          <span class="item-label">uuid:</span>
                          <span>{{item.uuid}}</span>
                        </div>

                        <!-- Workflow Origin Link -->
                        <div class="item-detail">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-database mr-1"></i>
                          </span>
                          <span class="item-label">origin: </span>
                          <span>
                            <a href="{{ item.originLink }}" target="_blank">{{
                              item.originLink
                              }}
                            </a></span>
                        </div>

                        <!-- Workflow Registry -->
                        <div class="item-detail" *ngIf="item.registry">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-database mr-1"></i>
                          </span>
                          <span class="item-label">registry ID: </span>
                          <span class="cut-text">
                            <a href="{{ item.registryLink }}" target="_blank">{{
                              item.registryLink
                              }}
                            </a></span>
                        </div>

                        <!-- Workflow Submitter -->
                        <div *ngIf="item?.version?.submitter" class="item-detail">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-solid fa-user mr-1"></i>
                          </span>
                          <span class="item-label">submitter: </span>
                          <span class="cut-text">
                            {{ item.version.submitter.username }}
                          </span>
                        </div>

                        <!-- Workflow Auhors -->
                        <div class="item-detail item-author"
                          *ngIf="item.version && item.authors && item.authors.length > 0">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-solid fa-users mr-1" style="margin-left: -2px;"></i>
                          </span>
                          <span class="item-label">author<span *ngIf="item.authors.length > 1">s</span>: </span>
                          <p *ngFor="let author of item.authors; index as a_index;" class="d-inline"
                            style="display: flex; flex-wrap: wrap; max-width: 200px;">
                            <span *ngIf="author.name && author.url" class="d-inline">
                              <a href="{{author.url}}" [innerHTML]="author.name">{{ author.name }}</a><span
                                class="m-0 p-0" *ngIf="a_index < item.authors.length - 1">, </span>
                            </span>
                            <span *ngIf="author.name && !author.url" class="d-inline">{{ author.name }}<span
                                class="m-0 p-0" *ngIf="a_index < item.authors.length - 1">, </span></span>
                          </p>
                        </div>
                      </div>
                      <!-- Workflows Details -->
                    </div>
                    <div *ngIf="isUserLogged()">
                      <span *ngIf="item.subscriptions !== undefined">
                        <a *ngIf="(searchModeEnabled || editModeEnabled || item.editingMode) && (!item.subscriptions || item.subscriptions.length == 0)"
                          class="badge badge-success mt-3 ml-n1 mr-2" (click)="subscribeWorkflow(item)" role="button"
                          data-toggle="tooltip" data-placement="bottom" data-html="true" [showDelay]="tooltipShowDelay"
                          pTooltip="Click to subscribe to this workflow and add it to your dashboard">
                          SUBSCRIBE
                        </a>
                        <div
                          *ngIf="!(editModeEnabled || item.editingMode) && searchModeEnabled && (item.subscriptions && item.subscriptions.length > 0)"
                          class="badge badge-primary mt-3 ml-n1 mr-2" (click)="unsubscribeWorkflow(item)" role="button"
                          data-toggle="tooltip" data-placement="bottom" data-html="true" [showDelay]="tooltipShowDelay"
                          pTooltip="Click to unsubscribe from this workflow and remove it from your dashboard">
                          SUBSCRIBED
                        </div>
                        <a *ngIf="(editModeEnabled || item.editingMode) && item.subscriptions && item.subscriptions.length > 0"
                          class="badge badge-danger mt-3 ml-n1 mr-2" (click)="unsubscribeWorkflow(item)" role="button"
                          data-toggle="tooltip" data-placement="bottom" data-html="true" [showDelay]="tooltipShowDelay"
                          pTooltip="Click to unsubscribe from this workflow and remove it from your dashboard">
                          UNSUBSCRIBE
                        </a>
                      </span>
                      <!-- <span *ngIf="!editModeEnabled">&nbsp;</span> -->
                    </div>
                  </div>

                  <!-- Workflow Visibility -->
                  <div class="col-1 d-none d-xl-block">
                    <div class="workflow-list-item-visibility">
                      <div *ngIf="isLoadingWorkflowVersion(item)">
                        <i class="fas fa-2x fa-sync-alt text-muted"></i>
                      </div>
                      <div *ngIf="!isLoadingWorkflowVersion(item)" data-html="true" data-toggle="tooltip"
                        data-placement="top" class="workflow-list-item-visibility workflow-visibility-{{item.uuid}}"
                        pTooltip="{{ getWorkflowVisibilityTitle(item) }}" [showDelay]="tooltipShowDelay">
                        <i *ngIf="item.public" class="fas fa-lg fa-globe-americas"></i>
                        <i *ngIf="!item.public" class="fas fa-lg fa-user-lock"></i>
                        <div class="text-muted text-xs">{{ item.public ? 'public': 'private' }}</div>

                        <!-- <div *ngIf="!isEditable(item) || !(editModeEnabled && item.editingMode)">&nbsp;</div> -->
                      </div>
                      <a *ngIf="isEditable(item) && (editModeEnabled || item.editingMode)"
                        class="btn badge badge-primary" (click)="changeVisibility(item)" [showDelay]="tooltipShowDelay"
                        [pTooltip]="item.public ? 'click to make the workflow private' : 'click to make the workflow public'">
                        change
                      </a>
                    </div>
                  </div>

                  <div class="col-1 d-none d-xl-block">
                    <div *ngIf="isLoadingWorkflowVersion(item)" class="text-muted">
                      <i class="fas fa-2x fa-sync-alt"></i>
                    </div>
                    <div *ngIf="!isLoadingWorkflowVersion(item)">
                      <div class="workflow-list-item-type" [showDelay]="tooltipShowDelay" data-html="true"
                        data-toggle="tooltip" data-placement="top"
                        pTooltip="<span class='text-xs'><i class='fas fa-question-circle mx-1'></i>{{item.type}} workflow</span>">
                        <img *ngIf="item.typeIcon" [src]="item.typeIcon" width="{{ item.typeIconSize }}" />
                        <i *ngIf="!item.typeIcon" class="far fa-question-circle fa-2x text-muted mr-2"></i>
                        <div class="text-muted text-xs mt-1">{{ item.type }}</div>
                      </div>
                    </div>
                  </div>

                  <div class="col-2 col-xl-1 d-none d-md-block">
                    <div class="workflow-list-item-version-selector" [showDelay]="tooltipShowDelay"
                      pTooltip="select a workflow version" tooltipPosition="top">
                      <workflow-version-selector [workflow]="item.workflow"
                        (workflow_version)="updateSelectedVersion($event)">
                      </workflow-version-selector>
                    </div>
                  </div>

                  <div class="col-1 d-none d-xl-block">
                    <div class="workflow-list-item-suites-chart">
                      <div *ngIf="!isLoadingWorkflowVersion(item) && item.suites && item.suites.all.length == 0"
                        data-toggle="tooltip" data-placement="top" data-html="true" title="<span class='text-xs'><i class='fas fa-question-circle mx-1'></i>
                      no test suite available<br/> for this workflow version</span>">
                        <i class="fas fa-ban fa-2x text-muted"></i>
                      </div>
                      <div *ngIf="item.suites === undefined || isLoadingWorkflowVersion(item)" class="text-muted">
                        <i class="fas fa-2x fa-sync-alt"></i>
                      </div>
                      <a *ngIf="!isLoadingWorkflowVersion(item) && item.suites && item.suites.all.length > 0"
                        [routerLink]="['/workflow', { uuid: item.asUrlParam() }]">
                        <stats-pie-chart [stats]="item.suites"></stats-pie-chart>
                      </a>
                    </div>
                  </div>

                  <div class="col-3 col-xl-2 d-none d-md-block">
                    <div class="workflow-list-item-builds-chart">
                      <div *ngIf="!isLoadingWorkflowVersion(item) && item.suites && item.suites.all.length == 0"
                        data-toggle="tooltip" data-placement="top" data-html="true" title="<span class='text-xs'><i class='fas fa-question-circle mx-1'></i>
                      no test build available<br/> for this workflow version</span>">
                        <i class="fas fa-ban fa-2x text-muted"></i>
                      </div>
                      <div *ngIf="item.suites === undefined || isLoadingWorkflowVersion(item)" class="text-muted">
                        <i class="fas fa-2x fa-sync-alt"></i>
                      </div>
                      <stats-bar-chart *ngIf="!isLoadingWorkflowVersion(item) && item.getLatestBuilds().length > 0"
                        [stats]="item.getLatestBuilds() | arraySizeFilterPipe: 10"
                        (selectedItem)="selectTestBuild($event)">
                      </stats-bar-chart>
                    </div>
                  </div>
                </div>

                <div class="d-inline-flex workflow-list-item-actions flex-column">

                  <div *ngIf="!isEnabledWorkflowEditMode(item) && isEditable(item)">
                    <a class="btn" (click)="enableWorkflowEditMode(item)" [showDelay]="tooltipShowDelay"
                      pTooltip="click to edit the workflow" tooltipPosition="left">
                      <span *ngIf="workflows && workflows.length > 0">
                        <i class="fas fa-edit mx-1 text-muted workflow-list-edit-action"></i>
                      </span>
                    </a>
                  </div>

                  <div *ngIf="isEnabledWorkflowEditMode(item) && isEditable(item)">
                    <a class="btn btn-sm" (click)="openWorkflowVersionUploader(item.workflow)" data-toggle="tooltip"
                      tooltipPosition="left" data-html="true" [showDelay]="tooltipShowDelay"
                      pTooltip="<span class='text-xs'><i class='fas fa-question-circle mx-1'></i>add version</span>">
                      <!-- <i class="far fa-code-branch"></i> -->
                      <i class="fas fa-plus-circle" style="color: var(--eosc-green)"></i>
                      <!-- <img src="assets/icons/branch-add.png" width="50px"> -->
                    </a>
                  </div>
                  <div *ngIf="isEnabledWorkflowEditMode(item) && isEditable(item)">
                    <a class="btn btn-sm" [routerLink]="" (click)="deleteWorkflowVersion(item)" data-toggle="tooltip"
                      tooltipPosition="left" data-html="true" [showDelay]="tooltipShowDelay"
                      pTooltip="<div class='text-xs align-items-md-center flex'> <i class='fas fa-question-circle mx-1'></i><span>delete version</span></div>">
                      <i class="fas fa-minus-circle" style="color: var(--eosc-yellow)"></i>
                      <!-- <img src="assets/icons/branch-delete.png" width="50px"> -->
                    </a>
                  </div>
                  <div *ngIf="isEnabledWorkflowEditMode(item) && isEditable(item)">
                    <a class="btn btn-sm" [routerLink]="" (click)="deleteWorkflow(item.workflow)" data-toggle="tooltip"
                      tooltipPosition="left" data-html="true" [showDelay]="tooltipShowDelay"
                      pTooltip="<span class='text-xs'><i class='fas fa-question-circle mx-1'></i>delete workflow</span>">
                      <i class="fas fa-trash-alt" style="color: var(--danger)"></i>
                    </a>
                  </div>
                  <div *ngIf="isEnabledWorkflowEditMode(item) && isEditable(item)">
                    <a class="btn btn-sm active" (click)="disableWorkflowEditMode(item)" data-toggle="tooltip"
                      tooltipPosition="left" data-html="true" [showDelay]="tooltipShowDelay"
                      pTooltip="<span class='text-xs'><i class='fas fa-question-circle mx-1'></i>close edit mode</span>">
                      <i class="fas fa-times-circle" style="color: var(--eosc-brown)"></i>
                    </a>
                  </div>
                </div>


              </div>

              <!-- </div> -->
            </ng-template>
            <ng-template let-item pTemplate="gridItem" class="dashboard-grid-layout ">
              <div class="d-inline-flex w-100 col-xl-4 col-lg-6 col-md-12">
                <div class="workflow-grid-item">
                  <div class="workflow-grid-item-top">
                    <div class="workflow-grid-item-edit-action"
                      *ngIf="isEditable(item) && !isEnabledWorkflowEditMode(item)">
                      <i class="far fa-edit" aria-hidden="true" (click)="enableWorkflowEditMode(item)"></i>
                    </div>
                    <div class="workflow-grid-item-edit-action"
                      *ngIf="isEditable(item) && isEnabledWorkflowEditMode(item)">
                      <i class="far fa-window-close" (click)="updateWorkflowName(item)"></i>
                    </div>
                  </div>

                  <div class="workflow-grid-item-content">

                    <div class="workflow-grid-item-status" [ngClass]="item.class">
                      <i class="{{ item.statusIcon }} fa-2x"></i>
                    </div>

                    <div class="workflow-grid-item-description text-center">
                      <!-- Workflow Name -->
                      <div class="item-name" [class.large-font]="item.workflow.name">
                        <input *ngIf="item.editingMode" type="text"
                          class="form-control datatable-input-no-border text-center" [(ngModel)]="item.workflow.name"
                          aria-describedby="workflowNameInput" placeholder="Enter workflow name"
                          (keyup.enter)="updateWorkflowName(item)" (keyup.esc)="restoreWorkflowName(item)" autofocus>
                        <a *ngIf="!item.editingMode" (click)="showWorkflowDetails(item)"
                          style="color: black; font-size: larger" (dblclick)="enableWorkflowEditMode(item)"
                          data-toggle="tooltip" data-placement="top" data-html="true" title="<span class='text-xs'>
                    <i class='fas fa-question-circle mx-1'></i>
                    click to see <b>suites</b>
                    <i class='fas fa-external-link-alt mx-1'></i>
                    {{ isEditable(item) ? '<br/>or double click to edit' : ''}}</span>">
                          {{ item.workflow.name }}
                        </a>
                      </div>

                      <!-- Workflow Details -->
                      <div class="workflow-item-details">

                        <!-- Workflow UUID -->
                        <div class="item-detail">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-solid fa-fingerprint" style="margin-right: .2rem"></i>
                          </span>
                          <span class="item-label">uuid:</span>
                          <span>{{item.uuid}}</span>
                        </div>

                        <!-- Workflow Origin Link -->
                        <div class="item-detail">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-database mr-1"></i>
                          </span>
                          <span class="item-label">origin: </span>
                          <span>
                            <a href="{{ item.originLink }}" target="_blank">{{
                              item.originLink
                              }}
                            </a></span>
                        </div>

                        <!-- Workflow Registry -->
                        <div class="item-detail" *ngIf="item.registry">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-database mr-1"></i>
                          </span>
                          <span class="item-label">registry ID: </span>
                          <span class="cut-text">
                            <a href="{{ item.registryLink }}" target="_blank">{{
                              item.registryLink
                              }}
                            </a></span>
                        </div>

                        <!-- Workflow Submitter -->
                        <div class="item-detail">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-solid fa-user mr-1"></i>
                          </span>
                          <span class="item-label">submitter: </span>
                          <span class="cut-text">
                            {{ item.version.submitter.username }}
                          </span>
                        </div>

                        <!-- Workflow Auhors -->
                        <div class="item-detail item-author"
                          *ngIf="item.version && item.authors && item.authors.length > 0">
                          <span class="item-icon">
                            <i class="fas fa-xs fa-solid fa-users mr-1" style="margin-left: -2px;"></i>
                          </span>
                          <span class="item-label">author<span *ngIf="item.authors.length > 1">s</span>: </span>
                          <p *ngFor="let author of item.authors; index as a_index;" class="d-inline"
                            style="display: flex; flex-wrap: wrap; max-width: 200px;">
                            <span *ngIf="author.name && author.url" class="d-inline">
                              <a href="{{author.url}}" [innerHTML]="author.name">{{ author.name }}</a><span
                                class="m-0 p-0" *ngIf="a_index < item.authors.length - 1">, </span>
                            </span>
                            <span *ngIf="author.name && !author.url" class="d-inline">{{ author.name }}<span
                                class="m-0 p-0" *ngIf="a_index < item.authors.length - 1">, </span></span>
                          </p>
                        </div>
                      </div>
                      <!-- Workflows Details -->
                    </div>
                    <div *ngIf="isUserLogged()">
                      <span *ngIf="item.subscriptions !== undefined">
                        <a *ngIf="(searchModeEnabled || editModeEnabled || item.editingMode) && (!item.subscriptions || item.subscriptions.length == 0)"
                          class="badge badge-success mt-3 ml-n1 mr-2" (click)="subscribeWorkflow(item)" role="button"
                          data-toggle="tooltip" data-placement="bottom" data-html="true"
                          title="Click to subscribe to this workflow and add it to your dashboard">
                          SUBSCRIBE
                        </a>
                        <div
                          *ngIf="!(editModeEnabled || item.editingMode) && searchModeEnabled && (item.subscriptions && item.subscriptions.length > 0)"
                          class="badge badge-primary mt-3 ml-n1 mr-2" (click)="unsubscribeWorkflow(item)" role="button"
                          data-toggle="tooltip" data-placement="bottom" data-html="true"
                          title="Click to unsubscribe from this workflow and remove it from your dashboard">
                          SUBSCRIBED
                        </div>
                        <a *ngIf="(editModeEnabled || item.editingMode) && item.subscriptions && item.subscriptions.length > 0"
                          class="badge badge-danger mt-3 ml-n1 mr-2" (click)="unsubscribeWorkflow(item)" role="button"
                          data-toggle="tooltip" data-placement="bottom" data-html="true"
                          title="Click to unsubscribe from this workflow and remove it from your dashboard">
                          UNSUBSCRIBE
                        </a>
                      </span>
                      <!-- <span *ngIf="!editModeEnabled">&nbsp;</span> -->
                    </div>



                    <!-- -->
                    <div class="workflow-grid-item-section">
                      <div class="workflow-grid-item-section-label">visibility</div>
                      <!-- <div class="workflow-grid-item-visibility"> -->
                      <div *ngIf="isLoadingWorkflowVersion(item)">
                        <i class="fas fa-2x fa-sync-alt text-muted"></i>
                      </div>
                      <div *ngIf="!isLoadingWorkflowVersion(item)" data-html="true" data-toggle="tooltip"
                        data-placement="top" class="workflow-grid-item-visibility workflow-visibility-{{item.uuid}}"
                        title="{{ getWorkflowVisibilityTitle(item) }}">
                        <i *ngIf="item.public" class="fas fa-lg fa-globe-americas"></i>
                        <i *ngIf="!item.public" class="fas fa-lg fa-user-lock"></i>
                        <div class="text-muted text-xs">{{ item.public ? 'public': 'private' }}</div>
                        <a *ngIf="isEditable(item) && (editModeEnabled || item.editingMode)"
                          class="btn badge badge-primary" (click)="changeVisibility(item)">
                          change
                        </a>
                        <!-- <div *ngIf="!isEditable(item) || !(editModeEnabled && item.editingMode)">&nbsp;</div> -->
                      </div>
                      <!-- </div> -->
                    </div>

                    <!-- -->
                    <div class="workflow-grid-item-section">
                      <div class="workflow-grid-item-section-label">version</div>
                      <div class="workflow-grid-item-version-selector">
                        <workflow-version-selector [workflow]="item.workflow"
                          (workflow_version)="updateSelectedVersion($event)">
                        </workflow-version-selector>
                      </div>
                    </div>

                    <!-- -->
                    <div class="workflow-grid-item-section">
                      <div class="workflow-grid-item-section-label">type</div>
                      <div *ngIf="isLoadingWorkflowVersion(item)" class="text-muted">
                        <i class="fas fa-2x fa-sync-alt"></i>
                      </div>
                      <div *ngIf="!isLoadingWorkflowVersion(item)">
                        <div class="workflow-grid-item-type" data-html="true" data-toggle="tooltip" data-placement="top"
                          title="<span class='text-xs'><i class='fas fa-question-circle mx-1'></i>{{item.type}} workflow</span>">
                          <img *ngIf="item.typeIcon" [src]="item.typeIcon" width="{{ item.typeIconSize }}" />
                          <i *ngIf="!item.typeIcon" class="far fa-question-circle fa-2x text-muted mr-2"></i>
                          <div class="text-muted text-xs mt-1">{{ item.type }}</div>
                        </div>
                      </div>
                    </div>

                    <!-- -->
                    <div class="workflow-grid-item-section">
                      <div class="workflow-grid-item-section-label">suites</div>
                      <div class="workflow-grid-item-suites-chart">
                        <div *ngIf="!isLoadingWorkflowVersion(item) && item.suites && item.suites.all.length == 0"
                          data-toggle="tooltip" data-placement="top" data-html="true" title="<span class='text-xs'><i class='fas fa-question-circle mx-1'></i>
                        no test suite available<br/> for this workflow version</span>">
                          <i class="fas fa-ban fa-2x text-muted"></i>
                        </div>
                        <div *ngIf="item.suites === undefined || isLoadingWorkflowVersion(item)" class="text-muted">
                          <i class="fas fa-2x fa-sync-alt"></i>
                        </div>
                        <a *ngIf="!isLoadingWorkflowVersion(item) && item.suites && item.suites.all.length > 0"
                          [routerLink]="['/workflow', { uuid: item.asUrlParam() }]">
                          <stats-pie-chart [stats]="item.suites"></stats-pie-chart>
                        </a>
                      </div>
                    </div>

                    <!-- -->
                    <div class="workflow-grid-item-section">
                      <div class="workflow-grid-item-section-label">latest builds</div>
                      <div class="workflow-grid-item-builds-chart">
                        <div *ngIf="!isLoadingWorkflowVersion(item) && item.suites && item.suites.all.length == 0"
                          data-toggle="tooltip" data-placement="top" data-html="true" title="<span class='text-xs'><i class='fas fa-question-circle mx-1'></i>
                        no test build available<br/> for this workflow version</span>">
                          <i class="fas fa-ban fa-2x text-muted"></i>
                        </div>
                        <div *ngIf="item.suites === undefined || isLoadingWorkflowVersion(item)" class="text-muted">
                          <i class="fas fa-2x fa-sync-alt"></i>
                        </div>
                        <stats-bar-chart *ngIf="!isLoadingWorkflowVersion(item) && item.getLatestBuilds().length > 0"
                          [stats]="item.getLatestBuilds() | arraySizeFilterPipe: 10"
                          (selectedItem)="selectTestBuild($event)">
                        </stats-bar-chart>
                      </div>
                    </div>
                  </div>

                  <!-- -->
                  <div class="workflow-grid-item-bottom">
                    <button pButton type="button" iconPos="left" class="p-button-md" label="Details"
                      icon="fa fa-info-circle" (click)="showWorkflowDetails(item)"></button>
                  </div>
                </div>
              </div>
            </ng-template>

            <ng-template pTemplate="empty">
              <!-- no workflow found/matching -->
              <div *ngIf="workflows && workflows.length === 0" class="no-workflow-container">

                <div class="no-workflow"
                  *ngIf="workflows && workflows.length === 0 && (!statusFilter && !workflowNameFilter)">
                  No workflow found
                </div>

                <div class="no-workflow"
                  *ngIf="workflows && workflows.length === 0 && (statusFilter || workflowNameFilter)">
                  No matching workflow
                </div>

                Click on
                <a class='add-wf' href="/dashboard;add=true">
                  <i class="fas fa-plus-circle"></i>
                  to register a workflow
                </a>
                <br>or use the main search box to find and subscribe
                <br>to workflows registered by others in the community
              </div>
              <!-- /.no workflow found/matching-->
            </ng-template>


          </p-dataView>

          <!-- /.card-body -->
        </div>
        <!-- /.card-body -->
      </div>

      <!-- /.card -->
    </div>
    <!-- </div> -->
  </div>
  <!-- /.content -->
</div>
